# FinSight ç»ˆææ¶æ„è®¾è®¡ï¼šæ™ºèƒ½é‡‘èåˆä¼™äºº

> ğŸ“… **æ›´æ–°æ—¥æœŸ**: 2026-01-12
> ğŸ¯ **æ ¸å¿ƒæ„¿æ™¯**: ä»è¢«åŠ¨é—®ç­”çš„"å·¥å…·äºº"å‡çº§ä¸ºä¸»åŠ¨æœåŠ¡çš„"æ™ºèƒ½åˆä¼™äºº"

---

## ä¸€ã€æ¶æ„å…¨æ™¯å›¾ (The Big Picture)

FinSight é‡‡ç”¨ **è®ºå›å¼å¤š Agent åä½œ** æ¶æ„ï¼Œæ¨¡ä»¿çœŸå®çš„é‡‘èæŠ•ç ”å›¢é˜Ÿè¿ä½œæ¨¡å¼ã€‚

```mermaid
flowchart TB
    subgraph Frontend["å‰ç«¯ (React + TS)"]
        UI[ChatList + StockChart]
        Profile[UserProfile ğŸ†•]
        Diag[DiagnosticsPanel]
    end

    subgraph Backend["åç«¯ (FastAPI + LangGraph)"]
        API["/chat API"]

        subgraph MemoryLayer["è®°å¿†ä¸ç”»åƒå±‚ (Phase 1.5)"]
            UserMem[UserContext & Memory]
            Watch[Watchlist Monitor]
        end

        subgraph Agents["å¤šAgentä¸“å®¶å›¢ (Phase 1)"]
            PA[PriceAgent<br/>(è¡Œæƒ…ä¸“å®¶)]
            NA[NewsAgent<br/>(èˆ†æƒ…ä¸“å®¶+åæ€)]
            TA[TechnicalAgent<br/>(æŠ€æœ¯åˆ†æå¸ˆ)]
            FA[FundamentalAgent<br/>(åŸºæœ¬é¢ç ”ç©¶å‘˜)]
            RA[RiskAgent ğŸ†•<br/>(é£æ§å®˜ Phase 3)]
        end

        subgraph OnDemand["æŒ‰éœ€è°ƒç”¨å±‚ (Phase 2)"]
            MA[MacroAgent<br/>(å®è§‚åˆ†æ)]
            DS[DeepSearchAgent<br/>(æ·±åº¦ç ”æŠ¥)]
        end

        subgraph Orchestration["ç¼–æ’ä¸å†³ç­–"]
            SUP[Supervisor<br/>(ä»»åŠ¡åˆ†å‘)]
            FH[ForumHost<br/>(é¦–å¸­æŠ•èµ„å®˜/å†²çªæ¶ˆè§£)]
        end

        subgraph Infrastructure["åŸºç¡€è®¾æ–½ (Phase 0)"]
            ORC[ToolOrchestrator]
            Cache[KV Cache]
            CB[CircuitBreaker]
            Alert[AlertSystem ğŸ†•]
        end

        subgraph Knowledge["çŸ¥è¯†æ£€ç´¢å±‚ (Phase 2) ğŸ†•"]
            VS[VectorStore<br/>(ChromaDB)]
            RAG[RAGEngine<br/>(åˆ‡ç‰‡+æ£€ç´¢)]
        end
    end

    %% Data Flow
    UI --> API
    API --> SUP
    SUP --> UserMem
    UserMem --> FH

    SUP --> PA & NA & TA & FA & RA
    PA & NA & TA & FA & RA --> ORC
    ORC --> Cache & CB

    %% RAG Flow
    DS --> RAG
    RAG --> VS

    %% Forum Mechanism
    PA & NA & TA & FA & RA --"AgentOutput"--> FH
    FH --"ForumOutput"--> API

    %% Background Jobs
    Alert -.-> Watch
    Watch -.-> UI
```

---

## äºŒã€æ ¸å¿ƒè§’è‰²å®šä¹‰

### 2.1 ä¸“å®¶ Agent å›¢é˜Ÿ (The Specialists)

| Agent | è§’è‰² | èŒè´£ | ç‰¹æ€§ |
|-------|------|------|------|
| **PriceAgent** | äº¤æ˜“å‘˜ | å®æ—¶ç›¯ç›˜ã€æŠ¥ä»·ã€ç›˜å£æ•°æ® | æé€Ÿå“åº” (TTL=30s)ï¼Œå¤šæºç†”æ–­ |
| **NewsAgent** | èˆ†æƒ…åˆ†æå¸ˆ | å…¨ç½‘æ–°é—»ã€ç¤¾äº¤åª’ä½“æƒ…ç»ª | **åæ€å¾ªç¯** (Reflection Loop) + å®˜æ–¹RSSä¼˜å…ˆï¼ˆReuters/Bloombergï¼‰+ Finnhub 48h + æœç´¢å›é€€ |
| **TechnicalAgent** | æŠ€æœ¯åˆ†æå¸ˆ | Kçº¿å½¢æ€ã€æŒ‡æ ‡èƒŒç¦» (MACD/RSI) | ç»“åˆå›¾è¡¨æ•°æ®ï¼Œç»™å‡ºä¹°å–ç‚¹ä½ |
| **FundamentalAgent** | ç ”ç©¶å‘˜ | è´¢æŠ¥è§£è¯»ã€ä¼°å€¼æ¨¡å‹ (DCF/PE) | å¤„ç†é•¿æ–‡æœ¬ï¼Œæ•°æ®æ¥æºäº 10-K/10-Q |
| **RiskAgent** ğŸ†• | é£æ§å®˜ | ä»“ä½ç®¡ç†ã€VaRè®¡ç®—ã€æ­¢æŸå»ºè®® | **ä¸ªæ€§åŒ–**ï¼ŒåŸºäºç”¨æˆ·é£é™©åå¥½ (Phase 3) |
| **MacroAgent** | å®è§‚åˆ†æå¸ˆ | å®è§‚ç»æµæ•°æ®ã€FRED API | å®æ—¶ CPI/GDP/åˆ©ç‡/å¤±ä¸šç‡ (Phase 2 å‡çº§) |

### 2.2 é¦–å¸­æŠ•èµ„å®˜ (ForumHost)

**ForumHost** æ˜¯æ•´ä¸ªç³»ç»Ÿçš„"å¤§è„‘"ï¼Œå®ƒä¸å†æ˜¯ç®€å•çš„æ‹¼æ¥å™¨ï¼Œè€Œæ˜¯å…·å¤‡**å†²çªæ¶ˆè§£**èƒ½åŠ›çš„å†³ç­–è€…ã€‚

*   **è¾“å…¥**ï¼šå„ Agent çš„ `AgentOutput`ï¼ˆå«ç½®ä¿¡åº¦ã€è¯æ®ï¼‰ã€‚
*   **å¤„ç†**ï¼š
    1.  **å†²çªæ£€æµ‹**ï¼šNews è¯´åˆ©å¥½ï¼ŒTech è¯´è¶…ä¹°ï¼Ÿ-> è¯†åˆ«åˆ†æ­§ç‚¹ã€‚
    2.  **è§‚ç‚¹èåˆ**ï¼šåŸºäºæƒé‡ï¼ˆå¦‚åŸºæœ¬é¢ > æŠ€æœ¯é¢ï¼‰ç”Ÿæˆæœ€ç»ˆåˆ¤æ–­ã€‚
    3.  **ä¸ªæ€§åŒ–æ³¨å…¥**ï¼šè¯»å– `UserContext`ï¼Œè°ƒæ•´å»ºè®®è¯­æ°”ï¼ˆæ¿€è¿› vs ä¿å®ˆï¼‰ã€‚
*   **è¾“å‡º**ï¼šç»“æ„åŒ–çš„ `ReportIR`ï¼ˆä¸­é—´è¡¨ç¤ºï¼‰ã€‚

---

## ä¸‰ã€å…³é”®æœºåˆ¶è¯¦è§£

### 3.1 åæ€å¾ªç¯ (Reflection Loop)

NewsAgent å’Œ DeepSearchAgent æ‹¥æœ‰è‡ªæˆ‘ä¿®æ­£èƒ½åŠ›ï¼š

```mermaid
sequenceDiagram
    participant A as Agent
    participant LLM
    participant Tool

    A->>Tool: 1. åˆå§‹å®½æ³›æœç´¢
    Tool-->>A: è¿”å›æµ·é‡æ‚ä¹±ä¿¡æ¯

    loop Reflection (Max 2 rounds)
        A->>LLM: 2. æ€»ç»“å¹¶è¯†åˆ«"çŸ¥è¯†ç©ºç™½"(Gaps)
        LLM-->>A: "ç¼ºå°‘å…·ä½“å‘å¸ƒæ—¥æœŸ" / "ç¼ºå°‘ç«å“å¯¹æ¯”"

        opt æœ‰ç©ºç™½
            A->>Tool: 3. é’ˆå¯¹æ€§ç²¾ç‚¼æœç´¢ (Targeted Search)
            Tool-->>A: è¡¥å……ç»†èŠ‚
            A->>A: 4. æ›´æ–°æ€»ç»“
        end
    end

    A->>Output: ç”Ÿæˆæœ€ç»ˆ AgentOutput
```

### 3.2 æ™ºèƒ½åˆä¼™äººè®°å¿† (UserContext)

ç³»ç»Ÿä¸å†æ˜¯"é˜…åå³ç„š"çš„èŠå¤©æœºå™¨äººï¼Œè€Œæ˜¯æœ‰è®°å¿†çš„ä¼™ä¼´ã€‚

*   **é™æ€ç”»åƒ**ï¼šé£é™©ç­‰çº§ (Conservative/Aggressive)ã€èµ„é‡‘ä½“é‡ã€æŠ•èµ„ç›®æ ‡ã€‚
*   **åŠ¨æ€å…³æ³¨**ï¼šWatchlistï¼ˆè‡ªé€‰è‚¡ï¼‰ã€æŒä»“æˆæœ¬ã€‚
*   **äº¤äº’å†å²**ï¼šè®°ä½ç”¨æˆ·åå¥½çš„è¡Œä¸šï¼ˆ"ä»–å–œæ¬¢ç§‘æŠ€è‚¡"ï¼‰ã€‚

### 3.3 çŸ¥è¯†æ£€ç´¢å¢å¼º (RAG - Phase 2) ğŸ†•

ç³»ç»Ÿå¼•å…¥å‘é‡æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰èƒ½åŠ›ï¼Œæ”¯æŒé•¿æ–‡æ¡£åˆ†æå’ŒçŸ¥è¯†åº“æ„å»ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RAGEngine                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ chunk_text  â”‚ -> â”‚   ingest    â”‚ -> â”‚   query     â”‚ â”‚
â”‚  â”‚ (åˆ‡ç‰‡+è¾¹ç•Œ) â”‚    â”‚ (å‘é‡åŒ–å…¥åº“)â”‚    â”‚ (ç›¸ä¼¼åº¦æ£€ç´¢)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                            â”‚
â”‚                            v                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                    â”‚ VectorStore â”‚                      â”‚
â”‚                    â”‚ (ChromaDB)  â”‚                      â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒç»„ä»¶**ï¼š
- **VectorStore**: ChromaDB å°è£…ï¼Œæ”¯æŒæŒä¹…åŒ–å’Œä¸´æ—¶é›†åˆ
- **RAGEngine**: æ–‡æ¡£åˆ‡ç‰‡ï¼ˆå¥å­è¾¹ç•Œæ£€æµ‹ï¼‰+ å‘é‡åŒ–å…¥åº“ + ç›¸ä¼¼åº¦æ£€ç´¢
- **Embedding**: `paraphrase-multilingual-MiniLM-L12-v2` å¤šè¯­è¨€æ¨¡å‹

**åº”ç”¨åœºæ™¯**ï¼š
- DeepSearchAgent é•¿æ–‡ç ”æŠ¥åˆ†æ
- ç”¨æˆ·è®°å¿†æŒä¹…åŒ–å­˜å‚¨
- å†å²å¯¹è¯ä¸Šä¸‹æ–‡æ£€ç´¢

### 3.4 ä¸»åŠ¨æœåŠ¡ (Active Service)

ä» Request-Response è½¬å˜ä¸º Event-Drivenï¼š

*   **åœºæ™¯**ï¼šç”¨æˆ·æ²¡æ‰“å¼€ Appï¼Œä½†æŒä»“è‚¡è´¢æŠ¥çªå‘æš´é›·ã€‚
*   **æµç¨‹**ï¼š`AlertSystem` è½®è¯¢ -> è§¦å‘ `RiskAgent` è¯„ä¼° -> è°ƒç”¨ `Notification` æ¥å£ -> æ¨é€"ç´§æ€¥é£é™©æç¤º"ã€‚

---

## å››ã€æ•°æ®æµä¸ä¸­é—´è¡¨ç¤º (IR)

ä¸ºäº†è§£è€¦ç”Ÿæˆä¸æ¸²æŸ“ï¼Œæˆ‘ä»¬å®šä¹‰äº† **ReportIR (Intermediate Representation)**ã€‚

```json
{
  "ticker": "AAPL",
  "user_context": {"risk_profile": "balanced"},
  "overall_sentiment": "bullish",
  "confidence_score": 0.85,
  "sections": [
    {
      "type": "consensus",
      "content": "å„æ–¹ä¸€è‡´çœ‹å¥½ AI æ‰‹æœºæ¢æœºæ½®...",
      "sources": ["NewsAgent", "FundamentalAgent"]
    },
    {
      "type": "conflict",
      "content": "æŠ€æœ¯é¢æ˜¾ç¤ºçŸ­æœŸè¶…ä¹°ï¼Œä½†åŸºæœ¬é¢ä¼°å€¼ä»åˆç†",
      "agents": ["TechnicalAgent", "FundamentalAgent"]
    }
  ],
  "actionable_advice": "å»ºè®®åˆ†æ‰¹å»ºä»“ï¼Œå›è°ƒè‡³ 200 æ—¥å‡çº¿æ—¶åŠ ä»“",
  "risks": ["åå„æ–­è¯‰è®¼", "æ¶ˆè´¹ç”µå­å‘¨æœŸä¸‹è¡Œ"]
}
```

---

## äº”ã€æŠ€æœ¯æ ˆå‡çº§

| å±‚çº§ | åŸæœ‰æ–¹æ¡ˆ | **å‡çº§æ–¹æ¡ˆ** |
|------|----------|--------------|
| **ç¼–æ’** | LangChain Agent | **LangGraph** (æ”¯æŒå¾ªç¯ä¸å¤šåˆ†æ”¯) |
| **æœç´¢** | DuckDuckGo | **Tavily / Exa** (ä¸“ä¸šç ”æŠ¥æœç´¢) |
| **ç¼“å­˜** | å†…å­˜ Dict | **Redis / SQLite** (æŒä¹…åŒ– KV) |
| **ç›‘æ§** | Printæ—¥å¿— | **LangSmith** (å…¨é“¾è·¯ Tracing) |
| **é£æ§** | æ—  | **VaR / MaxDrawdown è®¡ç®—å¼•æ“** |
| **å‘é‡å­˜å‚¨** ğŸ†• | æ—  | **ChromaDB** (æŒä¹…åŒ–å‘é‡æ•°æ®åº“) |
| **Embedding** ğŸ†• | æ—  | **Sentence Transformers** (å¤šè¯­è¨€æœ¬åœ°æ¨¡å‹) |
| **å®è§‚æ•°æ®** ğŸ†• | æ—  | **FRED API** (ç¾è”å‚¨ç»æµæ•°æ®) |

---

> ğŸš€ **Next Step**: è¿›å…¥ Phase 2 ç ”æŠ¥å¢å¼ºï¼ˆReportIR Schema/DeepSearch/Macroï¼‰ä¸å‰ç«¯æŠ¥å‘Šå¡ç‰‡å¯¹é½ã€‚
