# 市场指数识别功能

## ✅ 已完成

### 功能说明
系统现在可以自动识别市场指数的中文名称，并将其转换为对应的股票代码（Yahoo Finance格式）。

### 支持的市场指数

#### 纳斯达克
- **中文名称**: 纳斯达克、纳斯达克指数、纳指
- **股票代码**: `^IXIC`
- **英文名称**: nasdaq, nasdaq composite

#### 道琼斯
- **中文名称**: 道琼斯、道琼斯指数、道指
- **股票代码**: `^DJI`
- **英文名称**: dow jones, dow

#### 标普500
- **中文名称**: 标普500、标普
- **股票代码**: `^GSPC`
- **英文名称**: S&P 500, sp500, sp 500, 标准普尔500

#### 其他指数
- **罗素2000**: `^RUT` (罗素2000, russell 2000)
- **VIX恐慌指数**: `^VIX` (VIX, 恐慌指数, vix指数)
- **纽交所指数**: `^NYA` (纽交所, 纽交所指数, nyse)
- **富时100**: `^FTSE`
- **日经225**: `^N225`
- **恒生指数**: `^HSI`

## 🔧 实现细节

### 1. 映射表
在 `backend/conversation/router.py` 中添加了两个映射表：
- `CN_TO_TICKER`: 中文名称到股票代码的映射（包含公司和指数）
- `INDEX_ALIASES`: 市场指数的别名映射（更全面）

### 2. 元数据提取
`_extract_metadata` 方法现在会：
1. 优先识别市场指数（使用 `INDEX_ALIASES`）
2. 然后提取股票代码
3. 最后提取公司名称

### 3. 意图识别
- 添加了"涨跌"、"走势"、"如何"等关键词到简单查询关键词列表
- 当识别到市场指数时，自动归类为 `CHAT` 意图

## 📝 使用示例

### 测试结果
```
输入: "纳斯达克涨跌如何"
输出: Tickers: ['^IXIC'], Company names: ['纳斯达克']
Intent: chat

输入: "道琼斯怎么样"
输出: Tickers: ['^DJI'], Company names: ['道琼斯']
Intent: chat

输入: "标普500今天表现"
输出: Tickers: ['^GSPC'], Company names: ['标普500']
Intent: chat
```

## 🎯 用户体验改进

现在用户可以直接说：
- "纳斯达克涨跌如何" ✅
- "道琼斯怎么样" ✅
- "标普500今天表现" ✅
- "纳指走势" ✅

系统会自动识别并转换为对应的股票代码，无需用户提供具体的股票代码。

## 📍 文件位置

- `backend/conversation/router.py`: 意图识别和元数据提取
- `backend/tools.py`: 数据获取（已支持指数代码如 `^IXIC`）

