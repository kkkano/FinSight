# P0 执行记录（2026-01-09）

## 条目 1：/chat/stream 非 REPORT 真正 token 流式输出
- 时间：2026-01-09 12:32:11
- 目标：CHAT/FOLLOWUP 走真实 LLM token streaming，取消按句子切块的伪流式
- 变更：
  - 新增 ChatHandler.stream_with_llm / FollowupHandler.stream_with_llm
  - /chat/stream 对 CHAT/FOLLOWUP 使用真实 token 输出，并在末尾补 chart marker（如有）
  - 新增单元测试覆盖 chat/followup 流式输出
- 测试：
  - `python -m pytest backend/tests/test_streaming_chat_followup.py`
  - 结果：通过（pytest-asyncio 有一个 deprecation warning，未影响通过）
- 当前项目情况：
  - REPORT：已有真实流式（report_agent.analyze_stream）
  - CHAT/FOLLOWUP：已改为 token 级流式；无流式能力时回退为单次输出
  - /chat/stream：仍未接入 Supervisor 聚合与指代消解（待后续）
- 下一步动作：
  1) /chat/stream 接入 Supervisor 或提供等价报告流式聚合
  2) REPORT 意图稳定性与无 ticker 澄清优化
  3) /chat/stream 增加指代消解（resolve_reference）
