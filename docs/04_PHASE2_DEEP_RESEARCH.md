# FinSight é˜¶æ®µ2ï¼šæ·±åº¦ç ”æŠ¥ä¸æŒ‰éœ€è°ƒç”¨

> ğŸ“… **è®¡åˆ’å‘¨æœŸ**: Week 5 - Week 6
> ğŸ“… **æ›´æ–°æ—¥æœŸ**: 2026-01-20
> ğŸ¯ **æ ¸å¿ƒç›®æ ‡**: ç”Ÿäº§"å–æ–¹åˆ†æå¸ˆ"çº§åˆ«çš„æ·±åº¦ç ”æŠ¥ (Deep Research)

> ğŸ§© **è¿‘æœŸåŒæ­¥**: ReportIR citations å¢åŠ  confidence / freshness_hours å­—æ®µï¼ˆP0-2ï¼‰ã€‚
> ğŸ§­ **è¿‘æœŸåŒæ­¥**: News/Macro å›é€€ç»“æ„åŒ–è¾“å‡ºï¼Œé¿å… raw æ–‡æœ¬è¿›å…¥æŠ¥å‘Šï¼ˆP0-3ï¼‰ã€‚
> ğŸ§± **è¿‘æœŸåŒæ­¥**: get_company_news æ”¹ä¸ºç»“æ„åŒ–åˆ—è¡¨ï¼ŒNewsAgent/ReportHandler/ChatHandler åŒæ­¥é€‚é…ï¼ˆP1-1ï¼‰ã€‚
> ğŸ›¡ï¸ **è¿‘æœŸåŒæ­¥**: DeepSearch åŠ å…¥ SSRF é˜²æŠ¤ä¸é‡è¯•ç­–ç•¥ï¼ˆP1-2ï¼‰ã€‚
> ğŸ§ª **è¿‘æœŸåŒæ­¥**: pytest ç»Ÿä¸€æ”¶é›† backend/testsï¼Œtest/ ç›®å½•æ ‡è®°ä¸º legacyï¼ˆP1-3ï¼‰ã€‚
> ğŸ§  **è¿‘æœŸåŒæ­¥**: DeepSearch æŸ¥è¯¢æ¨¡æ¿åŠ¨æ€åŒ–ï¼ˆP2-1ï¼‰ã€‚
---

## 0. å½“å‰çŠ¶æ€ï¼ˆ2026-01-11ï¼‰

- /chat/stream å…¨æ„å›¾çœŸå® token æµå¼è¾“å‡ºå·²å®Œæˆï¼ˆå« REPORT done äº‹ä»¶ ReportIRï¼‰
- /chat ä¸ /chat/stream å·²æ¥å…¥å¼‚æ­¥ Supervisor ä¸æŒ‡ä»£æ¶ˆè§£
- Phase 1 æŠ€æœ¯/åŸºæœ¬é¢ Agent å·²è¡¥é½ï¼ŒReportIR Schema/Validator å·²å®Œæˆï¼ŒDeepSearch çœŸå®æ£€ç´¢ + PDF + Self-RAG å·²è½åœ°ï¼Œé‡ç‚¹è½¬å‘ Macro å‡çº§ä¸å‰ç«¯ç»“æ„åŒ–å¡ç‰‡ä¼˜åŒ–

## 1. æ ¸å¿ƒä»»åŠ¡æ‹†è§£

### 1.1 ä¸­é—´è¡¨ç¤ºå±‚ (IR)
- [x] **ReportIR Schema**: å®šä¹‰ `backend/report/ir.py`ã€‚
- [x] **IR Validator**: ç¡®ä¿ç”Ÿæˆçš„ JSON ç»“æ„å®Œæ•´ï¼Œé¿å…å‰ç«¯æ¸²æŸ“æŠ¥é”™ã€‚
- [x] **ReportIR Chart Option Spec**: ç»Ÿä¸€ chart è¾“å‡ºè§„èŒƒï¼ˆè§ `docs/REPORT_CHART_SPEC.md`ï¼Œ2026-01-11ï¼‰ã€‚

### 1.2 æŒ‰éœ€ Agent (On-Demand Agents)
- [x] **DeepSearchAgent**:
    - **è§¦å‘**: å½“ NewsAgent ä¿¡æ¯é‡ä¸è¶³ (<3 æ¡) æˆ–ç”¨æˆ·æ˜ç¡®è¦æ±‚"æ·±åº¦åˆ†æ"æ—¶ã€‚
    - **èƒ½åŠ›**: çœŸå®æ£€ç´¢ + PDF è§£æï¼Œæ”¯æŒ Self-RAG åæ€æ£€ç´¢ä¸äºŒæ¬¡è¡¥æ£€ã€‚
- [x] **MacroAgent**: âœ… å·²å®Œæˆ (2026-01-12)
    - **è§¦å‘**: æé—®æ¶‰åŠ"ç¾è”å‚¨"ã€"åŠ æ¯"ã€"é€šèƒ€"ç­‰å®è§‚è¯æ±‡ã€‚
    - **èƒ½åŠ›**: è°ƒç”¨ FRED API è·å–å®æ—¶ç»æµæ•°æ®ï¼ˆCPIã€è”é‚¦åŸºé‡‘åˆ©ç‡ã€GDPã€å¤±ä¸šç‡ã€10å¹´æœŸå›½å€ºã€æ”¶ç›Šç‡æ›²çº¿ï¼‰ã€‚
    - **ç‰¹æ€§**: è‡ªåŠ¨æ£€æµ‹è¡°é€€é¢„è­¦ä¿¡å·ï¼ˆæ”¶ç›Šç‡å€’æŒ‚ï¼‰ã€‚

### 1.3 å‰ç«¯å‡çº§
- [x] **ç»“æ„åŒ–æ¸²æŸ“**: `ReportView.tsx` å·²å¯¹é½ design_concept_v2.htmlï¼Œæ”¯æŒç« èŠ‚æŠ˜å ã€æ¥æºè·³è½¬ã€‚
- [x] **ç½®ä¿¡åº¦å¯è§†åŒ–**: ç½®ä¿¡åº¦è¿›åº¦æ¡å·²æ¥å…¥ ReportViewï¼Œæ”¯æŒå³æ—¶å±•ç¤ºã€‚
- [x] **äº¤äº’ç»†åŒ–**: ç« èŠ‚å®šä½ + æ»šåŠ¨é«˜äº® + å¼•ç”¨è”åŠ¨ + ECharts å›¾è¡¨æ¸²æŸ“å·²æ¥å…¥ã€‚
- [x] **è®¢é˜…é‚®ç®±æ¥å…¥**: Report å¡ç‰‡è®¢é˜…æŒ‰é’®ä½¿ç”¨ Settings é‚®ç®±ï¼ˆé¿å… promptï¼‰ã€‚

---

## 2. æ·±åº¦æœç´¢ç­–ç•¥

### 2.1 "å¹¿æ’’ç½‘ï¼Œç²¾æ•æ"
1.  **Broad Search**: `Tavily` æœç´¢ "AAPL investment thesis 2025"ã€‚
2.  **Freshness Gate**: ä¼˜å…ˆé‡‡ç”¨ Reuters/Bloomberg RSS + Finnhub 48h çš„æ–°é²œä¿¡å·ï¼Œè¿‡æœŸæ¡ç›®è§¦å‘è¡¥æ£€ã€‚
3.  **Filter**: è¿™é‡Œçš„ URL å“ªäº›æ˜¯æƒå¨åª’ä½“ï¼ˆWSJ, Bloombergï¼‰ï¼Ÿå“ªäº›æ˜¯æ°´æ–‡ï¼Ÿ
4.  **Deep Read**: å¯¹ç­›é€‰å‡ºçš„å‰ 3 ç¯‡æ–‡ç« è¿›è¡Œå…¨æ–‡æŠ“å– (`Jina Reader` æˆ– `Firecrawl`)ã€‚
5.  **Synthesize**: ç»“åˆé•¿ä¸Šä¸‹æ–‡çª—å£ç”Ÿæˆæ·±åº¦è§‚ç‚¹ã€‚

### 2.2 å®è§‚è”åŠ¨
- å¦‚æœ `MacroAgent` å‘ç°æœ€è¿‘å¤„äº"åŠ æ¯å‘¨æœŸ"ï¼Œè‡ªåŠ¨è°ƒä½æ‰€æœ‰æˆé•¿è‚¡çš„è¯„çº§ã€‚
- è¿™æ˜¯ä¸€ä¸ªè·¨ Agent çš„ Context å…±äº«æœºåˆ¶ã€‚

---

## 3. éªŒæ”¶æ ‡å‡†

1.  **ç ”æŠ¥è´¨é‡**: ç”Ÿæˆçš„æŠ¥å‘Šå¿…é¡»åŒ…å«è‡³å°‘ 2 ä¸ª"éæ˜¾è€Œæ˜“è§"çš„è§‚ç‚¹ï¼ˆInsightï¼‰ï¼Œä¸ä»…ä»…æ˜¯æ–°é—»å †ç Œã€‚
2.  **æ¥æºå¯æº¯**: æ¯ä¸€ä¸ªè®ºç‚¹ï¼ˆPointï¼‰å¿…é¡»é™„å¸¦è‡³å°‘ 1 ä¸ªå¯ç‚¹å‡»çš„å¼•ç”¨é“¾æ¥ï¼ˆCitationï¼‰ã€‚
3.  **é²æ£’æ€§**: å³ä½¿ `DeepSearch` å¤±è´¥ï¼Œä¹Ÿèƒ½ä¼˜é›…é™çº§ä¸ºæ™®é€šæ–°é—»æ‘˜è¦ï¼Œä¸æŠ¥é”™ã€‚

---

## 4. è¡¥å……æ›´æ–°ï¼ˆ2026-01-12ï¼‰

### 4.1 MacroAgent å‡çº§ - FRED API é›†æˆ

**å®ç°å†…å®¹**ï¼š
- **tools.py**: æ–°å¢ `get_fred_data()` å‡½æ•°ï¼Œæ”¯æŒ FRED API è°ƒç”¨
- **macro_agent.py**: é‡å†™ä¸ºçœŸå®æ•°æ®é©±åŠ¨ï¼Œä¸å†ä¾èµ–æ¨¡æ‹Ÿæ•°æ®

**æ”¯æŒçš„ç»æµæŒ‡æ ‡**ï¼š
| æŒ‡æ ‡ | Series ID | è¯´æ˜ |
|------|-----------|------|
| CPI é€šèƒ€ç‡ | CPIAUCSL | æ¶ˆè´¹è€…ä»·æ ¼æŒ‡æ•° |
| è”é‚¦åŸºé‡‘åˆ©ç‡ | FEDFUNDS | ç¾è”å‚¨åŸºå‡†åˆ©ç‡ |
| GDP å¢é•¿ç‡ | GDP | å›½å†…ç”Ÿäº§æ€»å€¼ |
| å¤±ä¸šç‡ | UNRATE | åŠ³åŠ¨åŠ›å¸‚åœºæŒ‡æ ‡ |
| 10å¹´æœŸå›½å€º | GS10 | é•¿æœŸåˆ©ç‡åŸºå‡† |
| æ”¶ç›Šç‡æ›²çº¿ | T10Y2Y | 10Y-2Y åˆ©å·®ï¼ˆè¡°é€€é¢„è­¦ï¼‰ |

**ç‰¹æ€§**ï¼š
- è‡ªåŠ¨æ£€æµ‹æ”¶ç›Šç‡å€’æŒ‚ï¼ˆrecession_warningï¼‰
- ç»“æ„åŒ–è¾“å‡ºå¤šæ¡ evidence é¡¹
- æ”¯æŒ `FRED_API_KEY` ç¯å¢ƒå˜é‡é…ç½®

### 4.2 Vector RAG åŸºç¡€è®¾æ–½

**æ–°å¢æ¨¡å—**: `backend/knowledge/`

```
backend/knowledge/
â”œâ”€â”€ __init__.py          # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ vector_store.py      # ChromaDB å°è£…ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰
â””â”€â”€ rag_engine.py        # RAG å¼•æ“ï¼ˆåˆ‡ç‰‡+æ£€ç´¢ï¼‰
```

**VectorStore ç‰¹æ€§**ï¼š
- ChromaDB æŒä¹…åŒ–å®¢æˆ·ç«¯ï¼ˆè‡ªåŠ¨å›é€€å†…å­˜æ¨¡å¼ï¼‰
- Sentence Transformers æœ¬åœ° Embeddingï¼ˆ`paraphrase-multilingual-MiniLM-L12-v2`ï¼‰
- æ”¯æŒä¸´æ—¶é›†åˆï¼ˆDeepSearch å·¥ä½œå°ï¼‰å’ŒæŒä¹…åŒ–é›†åˆï¼ˆç”¨æˆ·è®°å¿†ï¼‰

**RAGEngine ç‰¹æ€§**ï¼š
- æ™ºèƒ½æ–‡æ¡£åˆ‡ç‰‡ï¼ˆå¥å­è¾¹ç•Œæ£€æµ‹ + é‡å çª—å£ï¼‰
- æ‰¹é‡å…¥åº“ä¸ç›¸ä¼¼åº¦æ£€ç´¢
- `query_with_context()` ç›´æ¥è¿”å› LLM å¯ç”¨çš„ä¸Šä¸‹æ–‡å­—ç¬¦ä¸²

**ä¾èµ–**ï¼š
```
chromadb>=0.4.0
sentence-transformers>=2.2.0
```
