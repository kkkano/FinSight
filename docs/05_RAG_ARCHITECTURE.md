# FinSight RAG æ¶æ„å‡çº§è®¡åˆ’ (LlamaIndex + Chroma)

> ğŸ“… **è§„åˆ’æ—¥æœŸ**: 2025-12-28
> ğŸ“… **æ›´æ–°æ—¥æœŸ**: 2026-01-11
> ğŸ¯ **æ ¸å¿ƒç›®æ ‡**: å¼•å…¥å‘é‡æ•°æ®åº“ä¸ RAG æŠ€æœ¯ï¼Œçªç ´ Context é™åˆ¶ï¼Œèµ‹äºˆ Agent "é˜…è¯»é•¿æ–‡" å’Œ "é•¿æœŸè®°å¿†" çš„èƒ½åŠ›ã€‚

---

## 0. å½“å‰çŠ¶æ€ï¼ˆ2026-01-10ï¼‰

- RAG ä»æœªè½åœ°ï¼ŒDeepSearchAgent çœŸå®æ£€ç´¢ + PDF + Self-RAG å·²å®Œæˆï¼Œä¸ºå‘é‡åŒ–å…¥åº“æ‰“åº•
- æŠ€æœ¯é€‰å‹ä¿æŒ LlamaIndex + Chromaï¼Œæœ¬åœ°ä¼˜å…ˆï¼Œç¬¦åˆéšç§ä¸è½»é‡éƒ¨ç½²
- è®¡åˆ’å…ˆåš DeepSearch çš„ä¸´æ—¶å‘é‡å·¥ä½œå°ï¼Œå†æ‰©å±•ä¸ºç”¨æˆ·é•¿æœŸè®°å¿†

## 1. æŠ€æœ¯é€‰å‹å†³ç­–

### 1.1 å‘é‡æ•°æ®åº“ï¼šChroma (æœ¬åœ°æ¨¡å¼)
**å†³ç­–ç†ç”±**:
1.  **éšç§ç¬¬ä¸€**: FinSight å®šä½ä¸ºä¸ªäººé‡‘èåŠ©æ‰‹ï¼Œç”¨æˆ·çš„æŒä»“ã€åå¥½åŠç ”æŠ¥æ•°æ®åº”å°½å¯èƒ½ç•™åœ¨æœ¬åœ° (`./data/chroma_db`)ï¼Œé¿å…æ•æ„Ÿæ•°æ®ä¸Šäº‘ã€‚
2.  **è½»é‡çº§**: æ— éœ€ Dockerï¼Œ`pip install chromadb` å³å¯è¿è¡Œï¼Œéå¸¸é€‚åˆå•ä½“/å°å›¢é˜Ÿéƒ¨ç½²ã€‚
3.  **ç”Ÿæ€å‹å¥½**: ä¸ LangChain å’Œ LlamaIndex é›†æˆæˆç†Ÿã€‚

### 1.2 RAG æ¡†æ¶ï¼šLlamaIndex
**å†³ç­–ç†ç”±**:
1.  **æ•°æ®å¤„ç†å¼º**: åœ¨è§£æ PDFã€å¤æ‚è¡¨æ ¼ã€é•¿ç ”æŠ¥æ–¹é¢ï¼ŒLlamaIndex çš„ Data Loader æ¯” LangChain åŸç”Ÿå·¥å…·æ›´ä¸“ä¸šã€‚
2.  **æŸ¥è¯¢çµæ´»**: æ”¯æŒ "Summary Index" (æ€»ç»“å…¨æ–‡) å’Œ "Vector Store Index" (ç²¾å‡†æ£€ç´¢) çš„ç»„åˆæŸ¥è¯¢ï¼Œéå¸¸å¥‘åˆç ”æŠ¥åˆ†æåœºæ™¯ã€‚

---

## 2. æ ¸å¿ƒåº”ç”¨åœºæ™¯

æˆ‘ä»¬å°†åˆ†ä¸¤ä¸ªé˜¶æ®µå¼•å…¥ RAG èƒ½åŠ›ï¼š

### 2.1 åœºæ™¯ Aï¼šDeepSearchAgent çš„ "çŸ­æœŸå·¥ä½œå°" (Working Memory)
*   **ç—›ç‚¹**: ç ”æŠ¥é€šå¸¸ä¸º 20+ é¡µçš„ PDFï¼Œç›´æ¥é€šè¿‡ LLM å¤„ç† Token æ¶ˆè€—å·¨å¤§ä¸”æ˜“ä¸¢å¤±ç»†èŠ‚ã€‚
*   **æµç¨‹**:
    1.  `DeepSearchAgent` æŠ“å– PDF/URLã€‚
    2.  ä½¿ç”¨ **LlamaIndex** è§£æå¹¶åˆ‡ç‰‡ (Chunking)ã€‚
    3.  å­˜å…¥ **ä¸´æ—¶ Collection** (TTL = ä»»åŠ¡å‘¨æœŸ)ã€‚
    4.  Agent é’ˆå¯¹å…·ä½“é—®é¢˜ (Query) æ£€ç´¢ç›¸å…³ç‰‡æ®µ (Top-k)ã€‚
    5.  LLM åŸºäºæ£€ç´¢å†…å®¹ç”Ÿæˆè§‚ç‚¹ã€‚
    6.  ä»»åŠ¡ç»“æŸå**é”€æ¯**è¯¥ Collectionï¼Œé‡Šæ”¾èµ„æºã€‚

### 2.2 åœºæ™¯ Bï¼šUserContext çš„ "é•¿æœŸæµ·é©¬ä½“" (Long-term Memory)
*   **ç—›ç‚¹**: ç”¨æˆ·åå¥½æ•£è½åœ¨å†å²å¯¹è¯ä¸­ï¼Œä¼ ç»Ÿ Prompt æ³¨å…¥æ— æ³•è¦†ç›–é•¿å‘¨æœŸçš„è®°å¿†ã€‚
*   **æµç¨‹**:
    1.  å°†ç”¨æˆ·çš„å…³é”®é™ˆè¿° ("æˆ‘ä¸å–œæ¬¢ç™½é…’è‚¡"ã€"åªå…³æ³¨ç¾è‚¡ç§‘æŠ€") å‘é‡åŒ–å­˜å…¥ **æŒä¹…åŒ– Collection**ã€‚
    2.  æ¯æ¬¡ç”ŸæˆæŠ•èµ„å»ºè®®å‰ï¼Œæ ¹æ®å½“å‰ Ticker/Sector æ£€ç´¢ç›¸å…³çš„å†å²åå¥½ã€‚
    3.  å°†æ£€ç´¢åˆ°çš„ "Memory Highlights" æ³¨å…¥ System Promptã€‚

---

## 3. å®æ–½è·¯çº¿å›¾

### é˜¶æ®µ 2.5 (ç©¿æ’åœ¨å½“å‰é˜¶æ®µ)
- [ ] å¼•å…¥ `llama-index` å’Œ `chromadb` ä¾èµ–ã€‚
- [ ] åœ¨ `DeepSearchAgent` ä¸­å®ç°å‘é‡åŒ–å…¥åº“ï¼ˆPDF è¯»å–å·²å®Œæˆï¼‰ã€‚

### é˜¶æ®µ 3 (é£æ§ä¸ä¸»åŠ¨æœåŠ¡)
- [ ] å®ç°åŸºäº Chroma çš„é•¿æœŸè®°å¿†æ¨¡å— `VectorMemoryService`ã€‚

---

## 4. ç›®å½•ç»“æ„è§„åˆ’

```
backend/
â”œâ”€â”€ knowledge/              # [NEW] çŸ¥è¯†åº“æ¨¡å—
â”‚   â”œâ”€â”€ vector_store.py     # ChromaDB å•ä¾‹å°è£…
â”‚   â”œâ”€â”€ ingestion.py        # PDF/URL -> Chunks å¤„ç†æµ
â”‚   â””â”€â”€ rag_engine.py       # LlamaIndex æŸ¥è¯¢å¼•æ“å°è£…
```
