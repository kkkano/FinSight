# FinSight 阶段3：主动服务与风控体系

> 📅 **计划周期**: Week 7 - Week 8
> 📅 **更新日期**: 2026-01-10
> 🎯 **核心目标**: 实现"全天候监控"与"风险管理"，完成智能合伙人拼图

---

## 0. 当前状态（2026-01-10）

- AlertSystem/RiskAgent 仍为规划阶段，/subscribe 端点为占位实现
- Phase 0 已具备 RSS/Finnhub 时效链路与熔断/缓存基础，可作为主动服务的数据底座

## 1. 核心任务拆解

### 1.1 风控专家 (RiskAgent)
- [ ] **VaR 计算**: 引入 `numpy` / `pandas` 计算投资组合的在险价值。
- [ ] **持仓诊断**: 分析用户 Watchlist 的集中度（"你 80% 的仓位都在科技股，这很危险"）。

### 1.2 主动监控 (AlertSystem)
- [ ] **后台轮询器**: 独立的守护进程，每 15 分钟轮询一次关注列表。
- [ ] **官方新闻源**: Reuters/Bloomberg RSS + Finnhub 48h 作为新闻信号入口，过滤过期条目。
- [ ] **异动检测**:
    - 价格异动：涨跌幅 > 5%。
    - 新闻异动：Sentiment Score 突变。
- [ ] **推送服务**: 模拟 Webhook 推送或站内信。

---

## 2. 场景模拟

### 2.1 "黑天鹅"场景
- **事件**: 某日凌晨，美联储意外加息 50bp。
- **AlertSystem**: 监测到 Macro 数据剧烈波动。
- **RiskAgent**: 立即评估用户持仓（假设持有大量纳指 ETF）。
- **Action**: 在用户醒来前，生成一份"紧急早报"，建议"考虑对冲或减仓"。

### 2.2 "财报季"场景
- **事件**: 英伟达发布财报，超预期 20%。
- **AlertSystem**: 捕捉到盘后价格暴涨。
- **Orchestrator**: 唤醒 `FundamentalAgent` 解读财报。
- **Action**: 推送消息："NVDA 业绩炸裂，目标价上调至 $XXX"。

---

## 3. 验收标准

1.  **无感监控**: 系统能在无用户交互的情况下，后台自动运行并产生日志。
2.  **准确预警**: 只有"真正重要"的消息才推送，避免成为垃圾短信轰炸机。
3.  **计算准确**: RiskAgent 的回撤计算误差在可接受范围内。
